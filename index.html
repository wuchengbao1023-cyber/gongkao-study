<!DOCTYPE html>
<html>
<head>
    <title>å…¬è€ƒæ™ºèƒ½å­¦ä¹ ç³»ç»Ÿ | å®Œæ•´è‡ªå®šä¹‰æ¨¡å—åŠŸèƒ½</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* ===== åŸºç¡€é‡ç½® ===== */
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            -webkit-tap-highlight-color: transparent;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif; 
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            padding: 10px;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* ===== é¡¶éƒ¨çŠ¶æ€æ  ===== */
        .status-bar {
            background: white;
            border-radius: 14px;
            padding: 15px 18px;
            margin-bottom: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .status-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
        }
        
        .status-info {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            flex: 1;
            justify-content: space-between;
        }
        
        .status-item {
            text-align: center;
            min-width: 70px;
            flex: 1;
            position: relative;
        }
        
        .status-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .status-value {
            font-size: 20px;
            font-weight: 800;
            color: #2c3e50;
            font-feature-settings: "tnum";
        }
        
        /* ===== ä¸»å†…å®¹åŒºåŸŸ ===== */
        .main-content {
            display: block;
            gap: 15px;
        }
        
        @media (min-width: 992px) {
            .main-content {
                display: grid;
                grid-template-columns: 2.5fr 1.5fr;
            }
        }
        
        /* ===== å·¦ä¾§ï¼šå­¦ä¹ åŒº ===== */
        .learning-area {
            background: white;
            border-radius: 14px;
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.06);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        /* AIæ•™ç»ƒæé†’ */
        .ai-coach {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .ai-coach::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1%, transparent 1%);
            background-size: 15px 15px;
            opacity: 0.3;
        }
        
        .coach-content {
            position: relative;
            z-index: 2;
        }
        
        .coach-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .coach-avatar {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #667eea;
        }
        
        .coach-title {
            font-weight: 700;
            font-size: 16px;
        }
        
        .coach-message {
            font-size: 14px;
            opacity: 0.95;
            line-height: 1.5;
        }
        
        .coach-suggestion {
            background: rgba(255,255,255,0.15);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            border-left: 3px solid rgba(255,255,255,0.3);
        }
        
        .suggestion-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .suggestion-detail {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .suggestion-action {
            display: block;
            width: 100%;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .suggestion-action:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .progress-label {
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
        }
        
        .progress-percent {
            font-weight: 700;
            font-size: 16px;
            color: #27ae60;
        }
        
        .progress-bar {
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            border-radius: 4px;
            transition: width 0.8s ease;
            position: relative;
            overflow: hidden;
        }
        
        /* æ¨¡å—åˆ—è¡¨ */
        .modules-list {
            margin-top: 25px;
        }
        
        .modules-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .modules-title {
            font-size: 17px;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .module-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #dfe6e9;
            border-radius: 18px;
            background: white;
            font-size: 13px;
            color: #636e72;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .module-item {
            border: 1px solid #e0e6ed;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            background: white;
        }
        
        .module-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }
        
        .module-item.completed {
            background: linear-gradient(135deg, #f8fff8 0%, #f0f9f0 100%);
            border-color: #c8e6c9;
        }
        
        .module-item.recommended {
            background: linear-gradient(135deg, #fffaf0 0%, #fff8e1 100%);
            border-color: #ffd54f;
            animation: gentlePulse 3s infinite;
        }
        
        .module-item.weak {
            background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%);
            border-color: #ffcdd2;
            border-left: 4px solid #ff6b6b;
        }
        
        @keyframes gentlePulse {
            0%, 100% { box-shadow: 0 0 0 rgba(255, 193, 7, 0); }
            50% { box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.15); }
        }
        
        .module-number {
            position: absolute;
            top: 12px;
            left: 12px;
            width: 26px;
            height: 26px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            box-shadow: 0 3px 6px rgba(52, 152, 219, 0.3);
        }
        
        .module-content {
            margin-left: 36px;
        }
        
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .module-title {
            font-weight: 700;
            font-size: 16px;
            color: #2c3e50;
            line-height: 1.4;
        }
        
        .module-status {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 16px;
            font-weight: 600;
            letter-spacing: 0.2px;
        }
        
        .module-status.completed {
            background: #27ae60;
            color: white;
        }
        
        .module-status.recommended {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            color: white;
        }
        
        .module-status.weak {
            background: #ff6b6b;
            color: white;
        }
        
        .module-status.pending {
            background: #dfe6e9;
            color: #636e72;
        }
        
        .module-meta {
            font-size: 13px;
            color: #636e72;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .module-meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .module-stats {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        
        .stat-badge {
            font-size: 12px;
            padding: 5px 10px;
            background: #f8f9fa;
            border-radius: 10px;
            color: #2c3e50;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            border: 1px solid #edf2f7;
        }
        
        .stat-badge.highlight {
            background: #e3f2fd;
            color: #1976d2;
            border-color: #bbdefb;
        }
        
        .module-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        /* ===== æŒ‰é’®æ ·å¼ ===== */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            min-height: 44px;
            min-width: 44px;
            user-select: none;
        }
        
        .btn-complete {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            flex: 1;
        }
        
        .btn-details {
            background: #3498db;
            color: white;
            padding: 10px 14px;
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-manage {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }
        
        .btn-export {
            background: linear-gradient(135deg, #1abc9c, #16a085);
            color: white;
        }
        
        /* ===== å³ä¾§ï¼šåˆ†æåŒº ===== */
        .analytics-area {
            background: white;
            border-radius: 14px;
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.06);
            border: 1px solid rgba(255,255,255,0.3);
            height: fit-content;
        }
        
        .analytics-card {
            margin-bottom: 25px;
        }
        
        .analytics-card:last-child {
            margin-bottom: 0;
        }
        
        .analytics-title {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f4f8;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* å­¦ä¹ ä»ªè¡¨ç›˜ */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .dashboard-stat {
            text-align: center;
            padding: 12px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #edf2f7;
        }
        
        .dashboard-value {
            font-size: 20px;
            font-weight: 800;
            color: #2c3e50;
            margin: 6px 0;
            font-feature-settings: "tnum";
        }
        
        .dashboard-label {
            font-size: 11px;
            color: #718096;
            font-weight: 500;
        }
        
        /* è–„å¼±æ¨¡å— */
        .weak-modules {
            list-style: none;
        }
        
        .weak-module-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f4f8;
        }
        
        .weak-module-item:last-child {
            border-bottom: none;
        }
        
        .weak-module-name {
            font-size: 13px;
            flex: 1;
        }
        
        .weak-module-accuracy {
            font-weight: 700;
            color: #2c3e50;
        }
        
        .accuracy-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 8px;
            margin-left: 6px;
            font-weight: 600;
        }
        
        .accuracy-low {
            background: #ffeaea;
            color: #e53e3e;
        }
        
        /* ä»Šæ—¥å»ºè®® */
        .daily-tips {
            font-size: 13px;
            line-height: 1.6;
            color: #4a5568;
        }
        
        .tip-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 3px solid #4299e1;
        }
        
        .tip-icon {
            color: #4299e1;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        /* æ§åˆ¶æŒ‰é’®ç»„ */
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .control-buttons .btn {
            flex: 1;
            min-width: 0;
        }
        
        /* ===== å¼¹çª—æ ·å¼ ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 15px;
            backdrop-filter: blur(5px);
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            animation: modalSlideIn 0.4s ease;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 6px;
        }
        
        .modal-subtitle {
            font-size: 14px;
            color: #718096;
        }
        
        /* æ¨¡å—ç¼–è¾‘æ ·å¼ */
        .module-edit-list {
            margin-bottom: 20px;
        }
        
        .module-edit-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s;
        }
        
        .module-edit-item:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }
        
        .module-edit-item button {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .module-edit-item button:hover:not(:disabled) {
            background: #f7fafc;
            border-color: #cbd5e0;
            transform: translateY(-1px);
        }
        
        .module-edit-item button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .module-edit-item .delete-btn {
            border-color: #fed7d7;
            color: #e53e3e;
            background: #fff5f5;
        }
        
        .module-edit-item .delete-btn:hover {
            background: #fed7d7;
        }
        
        /* è¯¦æƒ…å¼¹çª— */
        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .detail-stat {
            text-align: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
        }
        
        .detail-stat-value {
            font-size: 24px;
            font-weight: 800;
            color: #2c3e50;
            margin: 8px 0;
        }
        
        .detail-stat-label {
            font-size: 12px;
            color: #718096;
        }
        
        .history-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
        }
        
        .history-date {
            font-size: 13px;
            color: #718096;
            margin-bottom: 4px;
        }
        
        .history-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #4a5568;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            min-height: 90px;
            transition: all 0.3s;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        
        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            transition: all 0.3s;
        }
        
        /* ç»ƒä¹ è®¾ç½®æ ·å¼ */
        .practice-settings {
            background: linear-gradient(135deg, #f8fafc 0%, #edf2f7 100%);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        
        .setting-item {
            margin-bottom: 16px;
        }
        
        .setting-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .setting-label-text {
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        
        .setting-value {
            font-weight: 700;
            color: #4299e1;
            font-size: 16px;
        }
        
        .range-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #e2e8f0, #4299e1);
            border-radius: 3px;
            outline: none;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid #4299e1;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(66, 153, 225, 0.3);
        }
        
        .number-input {
            width: 70px;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            text-align: center;
            color: #2c3e50;
        }
        
        /* å®æ—¶åé¦ˆ */
        .real-time-feedback {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin: 16px 0;
            border-left: 4px solid #48bb78;
        }
        
        .feedback-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        
        .feedback-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .feedback-item {
            text-align: center;
            padding: 8px;
            background: #f0fff4;
            border-radius: 6px;
        }
        
        .feedback-value {
            font-size: 16px;
            font-weight: 700;
            color: #38a169;
            margin: 4px 0;
        }
        
        .feedback-label {
            font-size: 11px;
            color: #718096;
        }
        
        /* ===== å“åº”å¼ä¼˜åŒ– ===== */
        @media (max-width: 767px) {
            .status-bar {
                padding: 14px;
                border-radius: 12px;
            }
            
            .status-info {
                gap: 10px;
            }
            
            .status-item {
                min-width: 65px;
            }
            
            .status-value {
                font-size: 18px;
            }
            
            .ai-coach {
                padding: 14px;
            }
            
            .coach-avatar {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }
            
            .learning-area, .analytics-area {
                padding: 16px;
                border-radius: 12px;
            }
            
            .module-item {
                padding: 14px;
            }
            
            .module-content {
                margin-left: 34px;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .modal-content {
                padding: 20px;
                margin: 5px;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .status-value {
                font-size: 16px;
            }
            
            .module-item {
                padding: 12px;
            }
            
            .module-content {
                margin-left: 32px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 13px;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="status-info">
                <div class="status-item">
                    <div class="status-label">ğŸ“Š å½“å‰è½®æ¬¡</div>
                    <div class="status-value" id="currentRound">1</div>
                </div>
                <div class="status-item">
                    <div class="status-label">ğŸ¯ æœ¬è½®è¿›åº¦</div>
                    <div class="status-value" id="todayProgress">0/8</div>
                </div>
                <div class="status-item">
                    <div class="status-label">ğŸ“ æ€»é¢˜æ•°</div>
                    <div class="status-value" id="totalQuestions">0</div>
                </div>
                <div class="status-item">
                    <div class="status-label">âœ… æ­£ç¡®ç‡</div>
                    <div class="status-value" id="accuracyRate">0%</div>
                </div>
            </div>
            <div>
                <!-- çœŸæ­£çš„æ¨¡å—ç®¡ç†æŒ‰é’® -->
                <button class="btn btn-manage" onclick="showEditModal()">
                    <span>âš™ï¸</span> æ¨¡å—ç®¡ç†
                </button>
            </div>
        </div>
        
        <!-- AIæ•™ç»ƒåŒºåŸŸ -->
        <div class="ai-coach">
            <div class="coach-content">
                <div class="coach-header">
                    <div class="coach-avatar">ğŸ‘¨â€ğŸ«</div>
                    <div>
                        <div class="coach-title">æ™ºèƒ½å­¦ä¹ æ•™ç»ƒ</div>
                        <div class="coach-message" id="coachMessage">æ­£åœ¨åˆ†æä½ çš„å­¦ä¹ æ•°æ®...</div>
                    </div>
                </div>
                <div class="coach-suggestion" id="coachSuggestion" style="display: none;">
                    <div class="suggestion-title">
                        <span>ğŸ¯ ä»Šæ—¥æ¨è</span>
                    </div>
                    <div class="suggestion-detail" id="recommendDetail"></div>
                    <button class="suggestion-action" id="recommendBtn">
                        ğŸš€ å¼€å§‹ç»ƒä¹ æ­¤æ¨¡å—
                    </button>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <!-- å·¦ä¾§ï¼šå­¦ä¹ åŒº -->
            <div class="learning-area">
                <!-- è¿›åº¦æ¡ -->
                <div class="progress-container">
                    <div class="progress-header">
                        <div class="progress-label">
                            <span>ğŸ“ˆ æœ¬è½®è¿›åº¦</span>
                            <span id="completedCount">0</span>/<span id="totalCount">8</span>
                        </div>
                        <div class="progress-percent" id="progressPercent">0%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- æ¨¡å—åˆ—è¡¨ -->
                <div class="modules-list">
                    <div class="modules-header">
                        <div class="modules-title">ğŸ“š å­¦ä¹ æ¨¡å—</div>
                        <div class="module-filters">
                            <button class="filter-btn active" onclick="filterModules('all')">å…¨éƒ¨</button>
                            <button class="filter-btn" onclick="filterModules('weak')">è–„å¼±</button>
                            <button class="filter-btn" onclick="filterModules('recommended')">æ¨è</button>
                            <button class="filter-btn" onclick="filterModules('completed')">å·²å®Œæˆ</button>
                        </div>
                    </div>
                    <div id="modulesContainer">
                        <!-- æ¨¡å—ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šåˆ†æåŒº -->
            <div class="analytics-area">
                <!-- å­¦ä¹ ä»ªè¡¨ç›˜ -->
                <div class="analytics-card">
                    <div class="analytics-title">ğŸ“Š å­¦ä¹ ä»ªè¡¨ç›˜</div>
                    <div class="dashboard-stats">
                        <div class="dashboard-stat">
                            <div class="dashboard-value" id="statTotalRounds">0</div>
                            <div class="dashboard-label">æ€»è½®æ•°</div>
                        </div>
                        <div class="dashboard-stat">
                            <div class="dashboard-value" id="statStreakDays">0</div>
                            <div class="dashboard-label">è¿ç»­å­¦ä¹ </div>
                        </div>
                        <div class="dashboard-stat">
                            <div class="dashboard-value" id="statAvgAccuracy">0%</div>
                            <div class="dashboard-label">å¹³å‡æ­£ç¡®ç‡</div>
                        </div>
                        <div class="dashboard-stat">
                            <div class="dashboard-value" id="statAvgQuestions">0</div>
                            <div class="dashboard-label">å¹³å‡é¢˜é‡/æ¬¡</div>
                        </div>
                    </div>
                </div>
                
                <!-- è–„å¼±æ¨¡å—æç¤º -->
                <div class="analytics-card">
                    <div class="analytics-title">âš ï¸ è–„å¼±æ¨¡å—</div>
                    <ul class="weak-modules" id="weakModulesList">
                        <li class="weak-module-item">
                            <div class="weak-module-name">æš‚æ— è–„å¼±æ¨¡å—</div>
                            <div class="weak-module-accuracy">-</div>
                        </li>
                    </ul>
                </div>
                
                <!-- ä»Šæ—¥å­¦ä¹ å»ºè®® -->
                <div class="analytics-card">
                    <div class="analytics-title">ğŸ’¡ ä»Šæ—¥å»ºè®®</div>
                    <div class="daily-tips" id="dailyTips">
                        <div class="tip-item">
                            <div class="tip-icon">ğŸ¯</div>
                            <div>ç³»ç»Ÿä¼šæ ¹æ®ä½ çš„å†å²è¡¨ç°æ™ºèƒ½æ¨èç»ƒä¹ æ¨¡å—</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="control-buttons">
            <button class="btn btn-reset" onclick="showResetModal()">
                <span>ğŸ”„</span> é‡ç½®æœ¬è½®
            </button>
            <button class="btn btn-reset" onclick="showClearAllModal()" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                <span>ğŸ—‘ï¸</span> æ¸…ç©ºæ•°æ®
            </button>
            <button class="btn btn-export" onclick="exportData()">
                <span>ğŸ“¤</span> å¯¼å‡ºæ•°æ®
            </button>
            <button class="btn btn-manage" onclick="showStatsModal()">
                <span>ğŸ“ˆ</span> å­¦ä¹ æŠ¥å‘Š
            </button>
        </div>
        
        <div class="footer" style="text-align: center; margin-top: 20px; padding: 15px; color: #718096; font-size: 13px;">
            <div>ğŸ’¾ æ•°æ®è‡ªåŠ¨ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ Â· åˆ·æ–°é¡µé¢ä¸ä¼šä¸¢å¤±</div>
            <div style="font-size: 12px; margin-top: 8px; color: #a0aec0;">å…¬è€ƒæ™ºèƒ½å­¦ä¹ ç³»ç»Ÿ v2.5 | å®Œæ•´è‡ªå®šä¹‰æ¨¡å—åŠŸèƒ½</div>
        </div>
    </div>
    
    <!-- ========== å¼¹çª—åŒºåŸŸ ========== -->
    
    <!-- æ¨¡å—è¯¦æƒ…å¼¹çª— -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="detailTitle">æ¨¡å—è¯¦æƒ…</div>
                <div class="modal-subtitle" id="detailSubtitle">æŸ¥çœ‹è¯¦ç»†ç»Ÿè®¡ä¸å†å²è®°å½•</div>
            </div>
            <div id="detailContent">
                <!-- è¯¦æƒ…å†…å®¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button type="button" class="btn btn-complete" onclick="startDetailModule()" style="flex: 1;">
                    <span>âœ…</span> å¼€å§‹ç»ƒä¹ 
                </button>
                <button type="button" class="btn" onclick="closeDetailModal()" style="flex: 1; background: #e2e8f0; color: #4a5568;">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡å—ç®¡ç†å¼¹çª— -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">âš™ï¸ æ¨¡å—ç®¡ç†</div>
                <div class="modal-subtitle">è‡ªå®šä¹‰ä½ çš„å­¦ä¹ æ¨¡å—ä¸è®¾ç½®</div>
            </div>
            <div class="module-edit-list" id="moduleEditList">
                <!-- ç¼–è¾‘åˆ—è¡¨ç”±JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn btn-manage" onclick="showAddModuleModal()">
                    <span>â•</span>
                    æ·»åŠ æ–°æ¨¡å—
                </button>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-complete" onclick="saveModules()" style="flex: 1;">
                    <span>ğŸ’¾</span>
                    ä¿å­˜è®¾ç½®
                </button>
                <button class="btn" onclick="closeEditModal()" style="flex: 1; background: #e2e8f0; color: #4a5568;">
                    å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ æ¨¡å—å¼¹çª— -->
    <div id="addModuleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">â• æ·»åŠ æ–°æ¨¡å—</div>
                <div class="modal-subtitle">åˆ›å»ºæ–°çš„å­¦ä¹ æ¨¡å—</div>
            </div>
            <form id="addModuleForm" onsubmit="return false;">
                <div class="form-group">
                    <label class="form-label">ğŸ“ æ¨¡å—åç§°</label>
                    <input type="text" class="form-input" id="newModuleName" placeholder="ä¾‹å¦‚ï¼šæ”¿æ²»ç†è®ºä¸“é¢˜" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ·ï¸ æ¨¡å—åˆ†ç±»</label>
                    <select class="form-select" id="newModuleCategory">
                        <option value="è¨€è¯­ç†è§£">è¨€è¯­ç†è§£</option>
                        <option value="åˆ¤æ–­æ¨ç†">åˆ¤æ–­æ¨ç†</option>
                        <option value="èµ„æ–™åˆ†æ">èµ„æ–™åˆ†æ</option>
                        <option value="æ•°é‡å…³ç³»">æ•°é‡å…³ç³»</option>
                        <option value="ç”³è®º">ç”³è®º</option>
                        <option value="å¸¸è¯†">å¸¸è¯†</option>
                        <option value="æ”¿æ²»ç†è®º">æ”¿æ²»ç†è®º</option>
                        <option value="ä¸“é¡¹è®­ç»ƒ">ä¸“é¡¹è®­ç»ƒ</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">â±ï¸ å»ºè®®æ—¶é—´</label>
                        <input type="number" class="form-input" id="newModuleTime" min="5" max="180" value="30" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ“ å»ºè®®é¢˜é‡</label>
                        <input type="number" class="form-input" id="newModuleQuestions" min="1" max="100" value="20" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ’¡ è¾“å‡ºä»»åŠ¡æè¿°</label>
                    <textarea class="form-textarea" id="newModuleDesc" rows="3" placeholder="ä¾‹å¦‚ï¼šæ¯é¢˜æ€»ç»“è§£é¢˜æ€è·¯ï¼Œè®°å½•æ˜“é”™ç‚¹"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn" onclick="closeAddModuleModal()" style="flex: 1; background: #e2e8f0; color: #4a5568;">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="btn btn-complete" onclick="addModule()" style="flex: 1;">
                        æ·»åŠ æ¨¡å—
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- å…¶ä»–å¼¹çª—ï¼ˆå®Œæˆç»ƒä¹ ã€é‡ç½®ã€æ¸…ç©ºæ•°æ®ç­‰ï¼‰ -->
    <div id="completeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="completeModuleTitle">å®Œæˆæ¨¡å—</div>
                <div class="modal-subtitle" id="completeModuleSubtitle">è¯·å¡«å†™æœ¬æ¬¡ç»ƒä¹ çš„è¯¦ç»†ä¿¡æ¯</div>
            </div>
            
            <div class="practice-settings">
                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-label-text">âœ… æœ¬æ¬¡ç»ƒä¹ é¢˜æ•°</div>
                        <div class="setting-value" id="currentQuestions">20</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <input type="range" class="range-slider" id="questionsSlider" min="5" max="100" value="20" style="flex: 1;">
                        <input type="number" class="number-input" id="questionsInput" min="5" max="100" value="20">
                        <span>é¢˜</span>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-label">
                        <div class="setting-label-text">âŒ é”™é¢˜æ•°é‡</div>
                        <div class="setting-value" id="wrongCountDisplay">0</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <input type="range" class="range-slider" id="wrongRange" min="0" max="50" value="0" style="flex: 1;">
                        <input type="number" class="number-input" id="wrongInput" min="0" max="100" value="0">
                        <span>é¢˜</span>
                    </div>
                </div>
            </div>
            
            <div class="real-time-feedback" id="realTimeFeedback">
                <div class="feedback-title">ğŸ“Š å®æ—¶è®¡ç®—ç»“æœ</div>
                <div class="feedback-content">
                    <div class="feedback-item">
                        <div class="feedback-value" id="accuracyDisplay">100%</div>
                        <div class="feedback-label">æœ¬æ¬¡æ­£ç¡®ç‡</div>
                    </div>
                    <div class="feedback-item">
                        <div class="feedback-value" id="totalQuestionsDisplay">0</div>
                        <div class="feedback-label">ç´¯è®¡é¢˜æ•°</div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">ğŸ“ æœ¬æ¬¡ç»ƒä¹ é‡ç‚¹ä¸å¿ƒå¾—</label>
                <textarea class="form-textarea" id="noteInput" placeholder="è®°å½•æœ¬æ¬¡ç»ƒä¹ çš„æ”¶è·ã€éš¾ç‚¹ã€éœ€è¦æ³¨æ„çš„åœ°æ–¹...ï¼ˆå¯é€‰ï¼‰"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button type="button" class="btn" onclick="closeCompleteModal()" style="flex: 1; background: #e2e8f0; color: #4a5568;">
                    å–æ¶ˆ
                </button>
                <button type="button" class="btn btn-complete" onclick="submitComplete()" style="flex: 2;">
                    <span>âœ…</span>
                    ç¡®è®¤å®Œæˆç»ƒä¹ 
                </button>
            </div>
        </div>
    </div>
    
    <!-- é‡ç½®ç¡®è®¤å¼¹çª— -->
    <div id="resetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ”„ é‡ç½®ç¡®è®¤</div>
                <div class="modal-subtitle">é‡ç½®å½“å‰è½®æ¬¡çš„è¿›åº¦</div>
            </div>
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 15px; color: #4a5568; margin-bottom: 20px; line-height: 1.6;">
                    è¿™å°†æ¸…ç©ºå½“å‰è½®æ¬¡æ‰€æœ‰æ¨¡å—çš„å®ŒæˆçŠ¶æ€ï¼Œå¼€å§‹æ–°ä¸€è½®å­¦ä¹ ã€‚<br>
                    <span style="color: #e53e3e; font-weight: 600;">å†å²ç»Ÿè®¡æ•°æ®ä¸ä¼šå—åˆ°å½±å“ã€‚</span>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn" onclick="closeResetModal()" style="background: #e2e8f0; color: #4a5568; padding: 12px 30px;">
                        å–æ¶ˆ
                    </button>
                    <button class="btn btn-reset" onclick="resetToday()" style="padding: 12px 30px;">
                        ç¡®è®¤é‡ç½®
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ¸…ç©ºæ•°æ®å¼¹çª— -->
    <div id="clearAllModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" style="color: #e53e3e;">âš ï¸ å±é™©æ“ä½œ</div>
                <div class="modal-subtitle">æ¸…ç©ºæ‰€æœ‰å­¦ä¹ æ•°æ®</div>
            </div>
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 14px; color: #4a5568; margin-bottom: 15px; text-align: left; padding: 12px; background: #fff5f5; border-radius: 8px; border-left: 4px solid #e53e3e;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: #e53e3e;">è¿™å°†åˆ é™¤æ‰€æœ‰å­¦ä¹ è®°å½•ï¼ŒåŒ…æ‹¬ï¼š</div>
                    <ul style="margin-left: 20px; line-height: 1.6;">
                        <li>æ‰€æœ‰æ¨¡å—çš„å†å²ç»Ÿè®¡æ•°æ®</li>
                        <li>æ€»ä½“å­¦ä¹ è¿›åº¦ä¸è½®æ¬¡è®°å½•</li>
                        <li>è¿ç»­å­¦ä¹ å¤©æ•°è®°å½•</li>
                        <li>è‡ªå®šä¹‰çš„æ¨¡å—è®¾ç½®</li>
                    </ul>
                </div>
                <div style="font-size: 15px; color: #e53e3e; font-weight: 600; margin: 20px 0; padding: 12px; background: #fed7d7; border-radius: 8px;">
                    ğŸš¨ æ­¤æ“ä½œä¸å¯æ¢å¤ï¼è¯·è°¨æ…æ“ä½œã€‚
                </div>
                <div class="form-group">
                    <label class="form-label">è¯·è¾“å…¥"DELETE"ç¡®è®¤æ“ä½œï¼š</label>
                    <input type="text" class="form-input" id="resetConfirmInput" placeholder="DELETE" oninput="this.value = this.value.toUpperCase()" style="text-align: center; letter-spacing: 2px;">
                </div>
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                    <button class="btn" onclick="closeClearAllModal()" style="background: #e2e8f0; color: #4a5568; padding: 12px 30px;">
                        å–æ¶ˆ
                    </button>
                    <button class="btn btn-reset" onclick="clearAllData()" style="padding: 12px 30px;" disabled id="clearAllBtn">
                        <span>ğŸ—‘ï¸</span>
                        æ¸…ç©ºæ‰€æœ‰æ•°æ®
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å­¦ä¹ æŠ¥å‘Šå¼¹çª—ï¼ˆç®€åŒ–ç‰ˆï¼‰ -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“ˆ å­¦ä¹ æŠ¥å‘Š</div>
                <div class="modal-subtitle">ä½ çš„å­¦ä¹ è¿›åº¦ä¸ç»Ÿè®¡</div>
            </div>
            <div id="statsContent" style="padding: 20px;">
                <div style="text-align: center; padding: 20px;">
                    <div class="loader"></div>
                    <div style="margin-top: 15px; color: #718096;">æ­£åœ¨ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š...</div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="closeStatsModal()" style="background: #e2e8f0; color: #4a5568; padding: 12px 30px;">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ============================================
        // å…¬è€ƒæ™ºèƒ½å­¦ä¹ ç³»ç»Ÿ v2.5
        // å®Œæ•´è‡ªå®šä¹‰æ¨¡å—åŠŸèƒ½ç‰ˆ
        // ============================================
        
        // å­¦ä¹ æ•°æ®
        const studyData = {
            currentDate: '',
            currentRound: 1,
            currentModuleIndex: 0,
            todayCompleted: 0,
            totalRounds: 0,
            
            overall: {
                totalQuestions: 0,
                totalCorrect: 0,
                streakDays: 0,
                totalDays: 0,
                lastStudyDate: '',
                totalTime: 0,
                totalSessions: 0,
                avgQuestionsPerSession: 0,
            },
            
            modules: [
                { id: 1, name: "è¨€è¯­ç‰‡æ®µé˜…è¯»", category: "è¨€è¯­ç†è§£", time: 30, questions: 20, desc: "æ¯é¢˜â‰¤10å­—å†™æ ¸å¿ƒè®ºç‚¹", order: 1 },
                { id: 2, name: "é€»è¾‘åˆ¤æ–­", category: "åˆ¤æ–­æ¨ç†", time: 35, questions: 20, desc: "å†™è®ºè¯ç±»å‹+é€»è¾‘é“¾", order: 2 },
                { id: 3, name: "èµ„æ–™åˆ†æ", category: "èµ„æ–™åˆ†æ", time: 35, questions: 20, desc: "å£è¿°æœ€éš¾è®¡ç®—æ€è·¯", order: 3 },
                { id: 4, name: "è¨€è¯­å¡«ç©º", category: "è¨€è¯­ç†è§£", time: 30, questions: 20, desc: "è®°å½•çŠ¹è±«é€‰é¡¹å¹¶è¾¨æ", order: 4 },
                { id: 5, name: "å›¾å½¢æ¨ç†", category: "åˆ¤æ–­æ¨ç†", time: 25, questions: 20, desc: "æ³¨é”™/æ…¢é¢˜'æ­»åœ¨ä½•æ­¥'", order: 5 },
                { id: 6, name: "å®šä¹‰åˆ¤æ–­", category: "åˆ¤æ–­æ¨ç†", time: 25, questions: 20, desc: "å…ˆè‡ªè¯é‡è¿°å®šä¹‰", order: 6 },
                { id: 7, name: "ç±»æ¯”æ¨ç†", category: "åˆ¤æ–­æ¨ç†", time: 20, questions: 20, desc: "é”™é¢˜åå‘æ„é€ ä¾‹å­", order: 7 },
                { id: 8, name: "ç»ˆæä»»åŠ¡", category: "ç»¼åˆè®­ç»ƒ", time: 60, questions: 1, desc: "ç”³è®º/é”™æ€/ä½“èƒ½ä¸‰é€‰ä¸€", order: 8 }
            ],
            
            moduleStats: {},
            
            daily: {
                date: '',
                completed: [],
                startTime: 0,
                totalTime: 0,
                sessions: []
            }
        };
        
        // å½“å‰æ¨èçš„æ¨¡å—ä¿¡æ¯
        let currentRecommendation = {
            index: -1,
            reason: ''
        };
        
        // å½“å‰æŸ¥çœ‹è¯¦æƒ…çš„æ¨¡å—ç´¢å¼•
        let currentDetailIndex = -1;
        
        // å½“å‰ç»ƒä¹ çš„æ¨¡å—ä¿¡æ¯
        let currentModuleInfo = null;
        
        // ============================================
        // åˆå§‹åŒ–
        // ============================================
        
        function init() {
            console.log("ğŸš€ ç³»ç»Ÿåˆå§‹åŒ–...");
            loadData();
            checkNewDay();
            initModuleStats();
            updateRecommendation();
            updateDisplay();
            setupEventListeners();
            
            // è®¾ç½®æ¨èæŒ‰é’®äº‹ä»¶
            document.getElementById('recommendBtn').onclick = startRecommended;
        }
        
        function loadData() {
            const saved = localStorage.getItem('studyData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    Object.keys(data).forEach(key => {
                        if (studyData[key] !== undefined) {
                            if (typeof studyData[key] === 'object' && studyData[key] !== null) {
                                Object.keys(data[key]).forEach(subKey => {
                                    studyData[key][subKey] = data[key][subKey];
                                });
                            } else {
                                studyData[key] = data[key];
                            }
                        }
                    });
                    console.log('âœ… æ•°æ®åŠ è½½æˆåŠŸ');
                } catch (e) {
                    console.error('âŒ æ•°æ®åŠ è½½å¤±è´¥', e);
                }
            }
        }
        
        function saveData() {
            try {
                localStorage.setItem('studyData', JSON.stringify(studyData));
                return true;
            } catch (e) {
                console.error('âŒ æ•°æ®ä¿å­˜å¤±è´¥', e);
                showNotification("ä¿å­˜å¤±è´¥", "å¯èƒ½æ˜¯å­˜å‚¨ç©ºé—´ä¸è¶³", "error");
                return false;
            }
        }
        
        function initModuleStats() {
            studyData.modules.forEach(module => {
                if (!studyData.moduleStats[module.id]) {
                    studyData.moduleStats[module.id] = {
                        attempts: 0,
                        totalQuestions: 0,
                        totalCorrect: 0,
                        bestAccuracy: 0,
                        lastAccuracy: 0,
                        history: [],
                        lastPracticeDate: '',
                        streak: 0,
                        avgQuestions: module.questions
                    };
                }
            });
        }
        
        // ============================================
        // æ¨¡å—è¯¦æƒ…åŠŸèƒ½
        // ============================================
        
        function showModuleDetails(index) {
            const module = studyData.modules[index];
            const stats = studyData.moduleStats[module.id] || {
                attempts: 0,
                totalQuestions: 0,
                totalCorrect: 0,
                history: []
            };
            
            currentDetailIndex = index;
            
            const accuracy = stats.attempts > 0 ? 
                (stats.totalCorrect / stats.totalQuestions * 100).toFixed(1) : 0;
            const bestAccuracy = stats.bestAccuracy ? stats.bestAccuracy.toFixed(1) : 0;
            const avgQuestions = stats.avgQuestions ? stats.avgQuestions.toFixed(0) : module.questions;
            
            let historyHTML = '<div style="font-weight: 600; margin: 15px 0 10px 0; color: #2c3e50;">æœ€è¿‘ç»ƒä¹ è®°å½•</div>';
            
            if (stats.history.length === 0) {
                historyHTML += '<div style="text-align: center; padding: 20px; color: #a0aec0; font-size: 14px;">æš‚æ— ç»ƒä¹ è®°å½•</div>';
            } else {
                stats.history.slice(-3).reverse().forEach(record => {
                    const date = new Date(record.date);
                    const dateStr = `${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`;
                    
                    historyHTML += `
                        <div class="history-item">
                            <div class="history-date">${dateStr} ${record.isRepeated ? 'ğŸ”„ é‡å¤ç»ƒä¹ ' : ''}</div>
                            <div class="history-stats">
                                <span>åšé¢˜ï¼š${record.practiceQuestions}é¢˜</span>
                                <span>é”™é¢˜ï¼š${record.wrongCount}é¢˜</span>
                                <span style="font-weight: 700; color: ${record.accuracy >= 80 ? '#27ae60' : record.accuracy >= 70 ? '#f39c12' : '#e74c3c'}">
                                    æ­£ç¡®ç‡ï¼š${record.accuracy.toFixed(1)}%
                                </span>
                            </div>
                            ${record.note ? `<div style="margin-top: 8px; font-size: 12px; color: #666; padding: 6px; background: #f8f9fa; border-radius: 4px;">ğŸ“ ${record.note}</div>` : ''}
                        </div>
                    `;
                });
                
                if (stats.history.length > 3) {
                    historyHTML += `<div style="text-align: center; margin-top: 10px; font-size: 12px; color: #718096;">è¿˜æœ‰${stats.history.length - 3}æ¡å†å²è®°å½•</div>`;
                }
            }
            
            document.getElementById('detailTitle').textContent = module.name;
            document.getElementById('detailSubtitle').textContent = module.desc;
            
            document.getElementById('detailContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <div class="detail-grid">
                        <div class="detail-stat">
                            <div class="detail-stat-value">${stats.attempts || 0}</div>
                            <div class="detail-stat-label">ç»ƒä¹ æ¬¡æ•°</div>
                        </div>
                        <div class="detail-stat">
                            <div class="detail-stat-value">${accuracy}%</div>
                            <div class="detail-stat-label">å¹³å‡æ­£ç¡®ç‡</div>
                        </div>
                        <div class="detail-stat">
                            <div class="detail-stat-value">${bestAccuracy}%</div>
                            <div class="detail-stat-label">æœ€ä½³æ­£ç¡®ç‡</div>
                        </div>
                        <div class="detail-stat">
                            <div class="detail-stat-value">${avgQuestions}</div>
                            <div class="detail-stat-label">å¹³å‡é¢˜é‡/æ¬¡</div>
                        </div>
                    </div>
                </div>
                
                ${historyHTML}
            `;
            
            document.getElementById('detailModal').style.display = 'flex';
        }
        
        function startDetailModule() {
            if (currentDetailIndex >= 0) {
                closeDetailModal();
                completeModule(currentDetailIndex);
            }
        }
        
        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
            currentDetailIndex = -1;
        }
        
        // ============================================
        // æ™ºèƒ½æ¨èåŠŸèƒ½
        // ============================================
        
        function findRecommendedModule() {
            const uncompletedModules = studyData.modules.filter(
                module => !studyData.daily.completed.includes(module.id)
            );
            
            if (uncompletedModules.length === 0) {
                return findWeakestModule();
            }
            
            for (let i = 0; i < studyData.modules.length; i++) {
                const module = studyData.modules[i];
                if (!studyData.daily.completed.includes(module.id)) {
                    const stats = studyData.moduleStats[module.id];
                    if (stats && stats.attempts > 0) {
                        const accuracy = stats.totalCorrect / stats.totalQuestions;
                        if (accuracy < 0.65) {
                            return { index: i, reason: `è–„å¼±æ¨¡å—ï¼ˆæ­£ç¡®ç‡${(accuracy*100).toFixed(1)}%ï¼‰` };
                        }
                    }
                }
            }
            
            for (let i = 0; i < studyData.modules.length; i++) {
                const module = studyData.modules[i];
                if (!studyData.daily.completed.includes(module.id)) {
                    const stats = studyData.moduleStats[module.id];
                    if (!stats || stats.attempts === 0) {
                        return { index: i, reason: 'æ–°æ¨¡å—ï¼Œå»ºè®®å°½æ—©å¼€å§‹' };
                    }
                }
            }
            
            for (let i = 0; i < studyData.modules.length; i++) {
                if (!studyData.daily.completed.includes(studyData.modules[i].id)) {
                    return { index: i, reason: 'å»ºè®®ç»§ç»­å®Œæˆæœ¬è½®' };
                }
            }
            
            return { index: 0, reason: 'æš‚æ— æ¨è' };
        }
        
        function findWeakestModule() {
            let weakestIndex = 0;
            let lowestAccuracy = 100;
            
            for (let i = 0; i < studyData.modules.length; i++) {
                const stats = studyData.moduleStats[studyData.modules[i].id];
                if (stats && stats.attempts > 0) {
                    const accuracy = (stats.totalCorrect / stats.totalQuestions) * 100;
                    if (accuracy < lowestAccuracy) {
                        lowestAccuracy = accuracy;
                        weakestIndex = i;
                    }
                }
            }
            
            return { index: weakestIndex, reason: `æœ€è–„å¼±æ¨¡å—ï¼ˆæ­£ç¡®ç‡${lowestAccuracy.toFixed(1)}%ï¼‰` };
        }
        
        function updateRecommendation() {
            currentRecommendation = findRecommendedModule();
            
            const suggestionEl = document.getElementById('coachSuggestion');
            const detailEl = document.getElementById('recommendDetail');
            
            if (currentRecommendation.index >= 0) {
                const module = studyData.modules[currentRecommendation.index];
                
                document.getElementById('coachMessage').innerHTML = `
                    <div style="margin-bottom: 5px;">å‡†å¤‡å¥½å¼€å§‹ä»Šå¤©çš„å­¦ä¹ äº†å—ï¼Ÿ</div>
                    <div style="font-size: 13px;">ä»Šæ—¥æ¨èï¼š<strong>${module.name}</strong></div>
                `;
                
                suggestionEl.style.display = 'block';
                detailEl.textContent = currentRecommendation.reason;
                
            } else {
                suggestionEl.style.display = 'none';
                document.getElementById('coachMessage').textContent = 'å‡†å¤‡å¥½å¼€å§‹ä»Šå¤©çš„å­¦ä¹ äº†å—ï¼Ÿ';
            }
        }
        
        function startRecommended() {
            if (currentRecommendation.index >= 0) {
                completeModule(currentRecommendation.index);
            }
        }
        
        // ============================================
        // æ ¸å¿ƒæ˜¾ç¤ºåŠŸèƒ½
        // ============================================
        
        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }
        
        function getYesterdayDate() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            return yesterday.toISOString().split('T')[0];
        }
        
        function checkNewDay() {
            const today = getTodayDate();
            
            if (studyData.currentDate !== today) {
                const yesterday = getYesterdayDate();
                if (studyData.overall.lastStudyDate === yesterday) {
                    studyData.overall.streakDays++;
                } else if (studyData.overall.lastStudyDate !== today) {
                    studyData.overall.streakDays = 1;
                }
                
                studyData.currentDate = today;
                studyData.overall.lastStudyDate = today;
                studyData.overall.totalDays++;
                
                studyData.daily.date = today;
                studyData.daily.startTime = Date.now();
                studyData.daily.sessions = [];
                
                updateRecommendation();
                saveData();
            }
        }
        
        function updateDisplay() {
            updateStatusBar();
            updateProgressBar();
            updateModuleList();
            updateAnalyticsPanel();
            updateRecommendation();
            saveData();
        }
        
        function updateStatusBar() {
            document.getElementById('currentRound').textContent = studyData.currentRound;
            
            const completedCount = studyData.daily.completed.length;
            const totalCount = studyData.modules.length;
            document.getElementById('todayProgress').textContent = `${completedCount}/${totalCount}`;
            
            document.getElementById('totalQuestions').textContent = studyData.overall.totalQuestions;
            
            const accuracy = studyData.overall.totalQuestions > 0 ? 
                ((studyData.overall.totalCorrect / studyData.overall.totalQuestions) * 100).toFixed(1) : 0;
            document.getElementById('accuracyRate').textContent = `${accuracy}%`;
        }
        
        function updateProgressBar() {
            const completedCount = studyData.daily.completed.length;
            const totalCount = studyData.modules.length;
            const progressPercent = totalCount > 0 ? (completedCount / totalCount * 100) : 0;
            
            document.getElementById('completedCount').textContent = completedCount;
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('progressPercent').textContent = `${Math.round(progressPercent)}%`;
            document.getElementById('progressBar').style.width = `${progressPercent}%`;
        }
        
        function updateModuleList() {
            const container = document.getElementById('modulesContainer');
            container.innerHTML = '';
            
            const filter = document.querySelector('.filter-btn.active')?.getAttribute('onclick')?.match(/'([^']+)'/)?.[1] || 'all';
            
            studyData.modules.forEach((module, index) => {
                const stats = studyData.moduleStats[module.id] || {
                    attempts: 0,
                    totalQuestions: 0,
                    totalCorrect: 0,
                    history: []
                };
                
                const isCompleted = studyData.daily.completed.includes(module.id);
                const isRecommended = currentRecommendation.index === index;
                const accuracy = stats.attempts > 0 ? (stats.totalCorrect / stats.totalQuestions * 100) : 0;
                const isWeak = stats.attempts > 0 && accuracy < 65;
                
                let showModule = true;
                switch(filter) {
                    case 'weak':
                        showModule = isWeak && !isCompleted;
                        break;
                    case 'recommended':
                        showModule = isRecommended;
                        break;
                    case 'completed':
                        showModule = isCompleted;
                        break;
                }
                
                if (!showModule) return;
                
                const moduleDiv = document.createElement('div');
                moduleDiv.className = `module-item ${isCompleted ? 'completed' : ''} ${isRecommended ? 'recommended' : ''} ${isWeak ? 'weak' : ''}`;
                
                let statusText = 'å¾…å®Œæˆ';
                let statusClass = 'pending';
                
                if (isCompleted) {
                    statusText = 'å·²å®Œæˆ';
                    statusClass = 'completed';
                } else if (isRecommended) {
                    statusText = 'â­ æ¨è';
                    statusClass = 'recommended';
                } else if (isWeak) {
                    statusText = 'âš ï¸ è–„å¼±';
                    statusClass = 'weak';
                }
                
                moduleDiv.innerHTML = `
                    <div class="module-number">${index + 1}</div>
                    <div class="module-content">
                        <div class="module-header">
                            <div class="module-title">${module.name}</div>
                            <div class="module-status ${statusClass}">${statusText}</div>
                        </div>
                        <div class="module-meta">
                            <span class="module-meta-item">ğŸ“ ${module.questions}é¢˜</span>
                            <span class="module-meta-item">â±ï¸ ${module.time}åˆ†é’Ÿ</span>
                            <span class="module-meta-item">ğŸ·ï¸ ${module.category}</span>
                        </div>
                        
                        ${stats.attempts > 0 ? `
                            <div class="module-stats">
                                <div class="stat-badge ${accuracy < 65 ? 'highlight' : ''}">
                                    <span>âœ…</span>
                                    æ­£ç¡®ç‡ï¼š${accuracy.toFixed(1)}%
                                </div>
                                <div class="stat-badge">
                                    <span>ğŸ“Š</span>
                                    ç»ƒä¹ ï¼š${stats.attempts}æ¬¡
                                </div>
                            </div>
                        ` : `
                            <div style="font-size: 12px; color: #636e72; padding: 8px 12px; background: #f8f9fa; border-radius: 8px; margin-bottom: 12px; border-left: 3px solid #3498db;">
                                ğŸ” æ–°æ¨¡å—ï¼Œå»ºè®®å…ˆå®Œæˆä¸€æ¬¡ç»ƒä¹ å»ºç«‹åŸºå‡†
                            </div>
                        `}
                        
                        <div class="module-actions">
                            <button class="btn btn-complete" onclick="completeModule(${index})" data-module-index="${index}">
                                <span>${isCompleted ? 'ğŸ”„' : 'âœ…'}</span>
                                ${isCompleted ? 'å†æ¬¡ç»ƒä¹ ' : 'å¼€å§‹ç»ƒä¹ '}
                            </button>
                            <button class="btn btn-details" onclick="showModuleDetails(${index})">
                                <span>ğŸ“Š</span>
                                è¯¦æƒ…
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(moduleDiv);
            });
            
            if (container.children.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #a0aec0;">
                        <div style="font-size: 40px; margin-bottom: 15px;">ğŸ“­</div>
                        <div style="font-size: 15px;">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æ¨¡å—</div>
                    </div>
                `;
            }
        }
        
        function filterModules(filterType) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            updateModuleList();
        }
        
        function updateAnalyticsPanel() {
            document.getElementById('statTotalRounds').textContent = studyData.totalRounds;
            document.getElementById('statStreakDays').textContent = studyData.overall.streakDays;
            
            const avgAccuracy = studyData.overall.totalQuestions > 0 ? 
                (studyData.overall.totalCorrect / studyData.overall.totalQuestions * 100).toFixed(1) : 0;
            document.getElementById('statAvgAccuracy').textContent = `${avgAccuracy}%`;
            
            const avgQuestions = studyData.overall.totalSessions > 0 ? 
                Math.round(studyData.overall.totalQuestions / studyData.overall.totalSessions) : 0;
            document.getElementById('statAvgQuestions').textContent = avgQuestions;
            
            updateWeakModulesList();
            updateDailyTips();
        }
        
        function updateWeakModulesList() {
            const container = document.getElementById('weakModulesList');
            container.innerHTML = '';
            
            const weakModules = studyData.modules
                .map(module => {
                    const stats = studyData.moduleStats[module.id];
                    if (!stats || stats.attempts === 0) return null;
                    
                    const accuracy = (stats.totalCorrect / stats.totalQuestions) * 100;
                    if (accuracy < 65) {
                        return {
                            module: module,
                            accuracy: accuracy
                        };
                    }
                    return null;
                })
                .filter(item => item !== null)
                .sort((a, b) => a.accuracy - b.accuracy)
                .slice(0, 3);
            
            if (weakModules.length === 0) {
                container.innerHTML = `
                    <li class="weak-module-item">
                        <div class="weak-module-name">ğŸ‰ æš‚æ— è–„å¼±æ¨¡å—</div>
                        <div class="weak-module-accuracy">ç»§ç»­ä¿æŒï¼</div>
                    </li>
                `;
                return;
            }
            
            weakModules.forEach(item => {
                const li = document.createElement('li');
                li.className = 'weak-module-item';
                
                li.innerHTML = `
                    <div class="weak-module-name">${item.module.name}</div>
                    <div>
                        <span class="weak-module-accuracy">${item.accuracy.toFixed(1)}%</span>
                        <span class="accuracy-badge accuracy-low">éœ€åŠ å¼º</span>
                    </div>
                `;
                container.appendChild(li);
            });
        }
        
        function updateDailyTips() {
            const container = document.getElementById('dailyTips');
            container.innerHTML = '';
            
            const tips = [];
            
            let weakCount = 0;
            studyData.modules.forEach(module => {
                const stats = studyData.moduleStats[module.id];
                if (stats && stats.attempts > 0) {
                    const accuracy = (stats.totalCorrect / stats.totalQuestions) * 100;
                    if (accuracy < 65) weakCount++;
                }
            });
            
            if (weakCount > 0) {
                tips.push({
                    icon: 'âš ï¸',
                    text: `å‘ç°${weakCount}ä¸ªè–„å¼±æ¨¡å—ï¼Œå»ºè®®é‡ç‚¹ç»ƒä¹ `
                });
            }
            
            if (studyData.overall.streakDays >= 3) {
                tips.push({
                    icon: 'ğŸ”¥',
                    text: `å·²è¿ç»­å­¦ä¹ ${studyData.overall.streakDays}å¤©ï¼Œç»§ç»­ä¿æŒï¼`
                });
            }
            
            const completed = studyData.daily.completed.length;
            const total = studyData.modules.length;
            
            if (completed === 0) {
                tips.push({
                    icon: 'ğŸ¯',
                    text: 'ä»Šå¤©å°šæœªå¼€å§‹å­¦ä¹ ï¼Œå»ºè®®è‡³å°‘å®Œæˆ1ä¸ªæ¨¡å—'
                });
            } else if (completed < total) {
                tips.push({
                    icon: 'âš¡',
                    text: `å·²å®Œæˆ${completed}/${total}ï¼Œç»§ç»­åŠ æ²¹ï¼`
                });
            }
            
            if (tips.length === 0) {
                tips.push(
                    { icon: 'ğŸ¯', text: 'ç³»ç»Ÿä¼šæ ¹æ®ä½ çš„å†å²è¡¨ç°æ™ºèƒ½æ¨èç»ƒä¹ æ¨¡å—' },
                    { icon: 'ğŸ“', text: 'è–„å¼±æ¨¡å—ä¼šè‡ªåŠ¨å»ºè®®å¢åŠ é¢˜é‡ï¼Œå»ºè®®é‡ç‚¹çªç ´' },
                    { icon: 'âš¡', text: 'å¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„æ¨¡å—ç»ƒä¹ ï¼Œä¸å†å—é¡ºåºé™åˆ¶' }
                );
            }
            
            tips.forEach(tip => {
                const tipDiv = document.createElement('div');
                tipDiv.className = 'tip-item';
                tipDiv.innerHTML = `
                    <div class="tip-icon">${tip.icon}</div>
                    <div>${tip.text}</div>
                `;
                container.appendChild(tipDiv);
            });
        }
        
        // ============================================
        // è‡ªå®šä¹‰æ¨¡å—ç®¡ç†åŠŸèƒ½ï¼ˆæ ¸å¿ƒï¼ï¼‰
        // ============================================
        
        function showEditModal() {
            updateModuleEditList();
            document.getElementById('editModal').style.display = 'flex';
        }
        
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }
        
        function updateModuleEditList() {
            const container = document.getElementById('moduleEditList');
            container.innerHTML = '';
            
            studyData.modules.forEach((module, index) => {
                const div = document.createElement('div');
                div.className = 'module-edit-item';
                div.innerHTML = `
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px; color: #2c3e50;">${module.name}</div>
                        <div style="font-size: 12px; color: #718096;">
                            ${module.category} Â· ${module.questions}é¢˜ Â· ${module.time}åˆ†é’Ÿ
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="moveModule(${index}, -1)" ${index === 0 ? 'disabled' : ''}>
                            â¬†ï¸
                        </button>
                        <button onclick="moveModule(${index}, 1)" ${index === studyData.modules.length-1 ? 'disabled' : ''}>
                            â¬‡ï¸
                        </button>
                        <button onclick="removeModule(${index})" class="delete-btn">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }
        
        function moveModule(index, direction) {
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= studyData.modules.length) return;
            
            // äº¤æ¢ä½ç½®
            [studyData.modules[index], studyData.modules[newIndex]] = 
            [studyData.modules[newIndex], studyData.modules[index]];
            
            // æ›´æ–°order
            studyData.modules.forEach((module, i) => {
                module.order = i + 1;
            });
            
            updateModuleEditList();
            updateDisplay();
            saveData();
        }
        
        function removeModule(index) {
            if (!confirm(`ç¡®å®šåˆ é™¤æ¨¡å—"${studyData.modules[index].name}"å—ï¼Ÿ\n\nâš ï¸ æ³¨æ„ï¼šè¯¥æ¨¡å—çš„å†å²ç»Ÿè®¡æ•°æ®ä¹Ÿå°†è¢«åˆ é™¤ï¼`)) {
                return;
            }
            
            const moduleId = studyData.modules[index].id;
            
            // åˆ é™¤æ¨¡å—ç»Ÿè®¡æ•°æ®
            delete studyData.moduleStats[moduleId];
            
            // åˆ é™¤æ¨¡å—
            studyData.modules.splice(index, 1);
            
            // æ›´æ–°order
            studyData.modules.forEach((module, i) => {
                module.order = i + 1;
            });
            
            // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰æ¨¡å—ï¼Œéœ€è¦è°ƒæ•´currentModuleIndex
            if (index <= studyData.currentModuleIndex) {
                studyData.currentModuleIndex = Math.max(0, studyData.currentModuleIndex - 1);
            }
            
            // ä»ä»Šæ—¥å®Œæˆåˆ—è¡¨ä¸­ç§»é™¤ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            studyData.daily.completed = studyData.daily.completed.filter(id => id !== moduleId);
            
            updateModuleEditList();
            updateDisplay();
            saveData();
            
            showNotification("æ¨¡å—å·²åˆ é™¤", "å­¦ä¹ æ¨¡å—å·²ä»åˆ—è¡¨ä¸­ç§»é™¤", "info");
        }
        
        function showAddModuleModal() {
            document.getElementById('newModuleName').value = '';
            document.getElementById('newModuleCategory').value = 'è¨€è¯­ç†è§£';
            document.getElementById('newModuleTime').value = 30;
            document.getElementById('newModuleQuestions').value = 20;
            document.getElementById('newModuleDesc').value = '';
            
            document.getElementById('editModal').style.display = 'none';
            document.getElementById('addModuleModal').style.display = 'flex';
            document.getElementById('newModuleName').focus();
        }
        
        function closeAddModuleModal() {
            document.getElementById('addModuleModal').style.display = 'none';
            showEditModal();
        }
        
        function addModule() {
            const name = document.getElementById('newModuleName').value.trim();
            const category = document.getElementById('newModuleCategory').value;
            const time = parseInt(document.getElementById('newModuleTime').value);
            const questions = parseInt(document.getElementById('newModuleQuestions').value);
            const desc = document.getElementById('newModuleDesc').value.trim();
            
            if (!name) {
                alert('è¯·è¾“å…¥æ¨¡å—åç§°ï¼');
                return;
            }
            
            if (isNaN(time) || time < 5) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ—¶é—´ï¼ˆè‡³å°‘5åˆ†é’Ÿï¼‰ï¼');
                return;
            }
            
            if (isNaN(questions) || questions < 1) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é¢˜é‡ï¼');
                return;
            }
            
            const newModule = {
                id: Date.now(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ID
                name: name,
                category: category,
                time: time,
                questions: questions,
                desc: desc || "è¯·æŒ‰è¦æ±‚å®Œæˆç»ƒä¹ ",
                order: studyData.modules.length + 1
            };
            
            studyData.modules.push(newModule);
            
            // åˆå§‹åŒ–ç»Ÿè®¡
            studyData.moduleStats[newModule.id] = {
                attempts: 0,
                totalQuestions: 0,
                totalCorrect: 0,
                bestAccuracy: 0,
                lastAccuracy: 0,
                history: [],
                lastPracticeDate: '',
                streak: 0,
                avgQuestions: questions
            };
            
            closeAddModuleModal();
            
            showNotification("æ¨¡å—å·²æ·»åŠ ", `æ–°æ¨¡å—"${name}"å·²æ·»åŠ åˆ°å­¦ä¹ åˆ—è¡¨`, "success");
        }
        
        function saveModules() {
            saveData();
            closeEditModal();
            updateDisplay();
            
            showNotification("è®¾ç½®å·²ä¿å­˜", "æ¨¡å—ç®¡ç†è®¾ç½®å·²æ›´æ–°", "success");
        }
        
        // ============================================
        // æ ¸å¿ƒç»ƒä¹ åŠŸèƒ½
        // ============================================
        
        function completeModule(index) {
            const module = studyData.modules[index];
            currentModuleInfo = {
                index: index,
                module: module,
                stats: studyData.moduleStats[module.id] || {
                    attempts: 0,
                    totalQuestions: 0,
                    totalCorrect: 0,
                    history: []
                }
            };
            
            const isRepeated = studyData.daily.completed.includes(module.id);
            
            document.getElementById('completeModuleTitle').textContent = `${isRepeated ? 'å†æ¬¡ç»ƒä¹ ï¼š' : 'å®Œæˆï¼š'}${module.name}`;
            document.getElementById('completeModuleSubtitle').textContent = isRepeated ? 'é‡å¤ç»ƒä¹ å·©å›ºæå‡ï¼Œå¯ä»¥è°ƒæ•´é¢˜é‡é‡ç‚¹çªç ´' : module.desc;
            
            const recommendedQuestions = module.questions;
            
            // è®¾ç½®åˆå§‹å€¼
            const questionsInput = document.getElementById('questionsInput');
            const questionsSlider = document.getElementById('questionsSlider');
            const wrongInput = document.getElementById('wrongInput');
            const wrongRange = document.getElementById('wrongRange');
            
            if (questionsInput) questionsInput.value = recommendedQuestions;
            if (questionsSlider) questionsSlider.value = recommendedQuestions;
            if (wrongInput) wrongInput.value = 0;
            if (wrongRange) wrongRange.value = 0;
            
            document.getElementById('currentQuestions').textContent = recommendedQuestions;
            document.getElementById('wrongCountDisplay').textContent = '0';
            
            updateRealTimeFeedback();
            
            document.getElementById('completeModal').style.display = 'flex';
            if (questionsInput) questionsInput.focus();
            
            currentModuleInfo.startTime = Date.now();
            currentModuleInfo.isRepeated = isRepeated;
        }
        
        function updateRealTimeFeedback() {
            if (!currentModuleInfo) return;
            
            const questionsInput = document.getElementById('questionsInput');
            const wrongInput = document.getElementById('wrongInput');
            
            if (!questionsInput || !wrongInput) return;
            
            const practiceQuestions = parseInt(questionsInput.value) || 20;
            const wrongCount = parseInt(wrongInput.value) || 0;
            
            const correctCount = Math.max(0, practiceQuestions - wrongCount);
            const accuracy = practiceQuestions > 0 ? (correctCount / practiceQuestions * 100).toFixed(1) : 0;
            
            const stats = currentModuleInfo.stats;
            
            document.getElementById('accuracyDisplay').textContent = `${accuracy}%`;
            document.getElementById('totalQuestionsDisplay').textContent = stats.totalQuestions + practiceQuestions;
            document.getElementById('currentQuestions').textContent = practiceQuestions;
            document.getElementById('wrongCountDisplay').textContent = wrongCount;
        }
        
        function submitComplete() {
            if (!currentModuleInfo) return;
            
            const questionsInput = document.getElementById('questionsInput');
            const wrongInput = document.getElementById('wrongInput');
            const noteInput = document.getElementById('noteInput');
            
            if (!questionsInput || !wrongInput || !noteInput) return;
            
            const practiceQuestions = parseInt(questionsInput.value);
            const wrongCount = parseInt(wrongInput.value);
            const note = noteInput.value.trim();
            
            if (isNaN(practiceQuestions) || practiceQuestions < 1) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç»ƒä¹ é¢˜æ•°ï¼');
                return;
            }
            
            if (isNaN(wrongCount) || wrongCount < 0 || wrongCount > practiceQuestions) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é”™é¢˜æ•°ï¼');
                return;
            }
            
            const module = currentModuleInfo.module;
            const stats = currentModuleInfo.stats;
            const isRepeated = currentModuleInfo.isRepeated;
            
            const correctCount = practiceQuestions - wrongCount;
            const accuracy = (correctCount / practiceQuestions) * 100;
            const practiceTime = currentModuleInfo.startTime ? Math.round((Date.now() - currentModuleInfo.startTime) / 60000) : module.time;
            
            // æ›´æ–°æ¨¡å—ç»Ÿè®¡
            stats.attempts++;
            stats.totalQuestions += practiceQuestions;
            stats.totalCorrect += correctCount;
            stats.bestAccuracy = Math.max(stats.bestAccuracy, accuracy);
            stats.lastPracticeDate = new Date().toISOString();
            stats.avgQuestions = stats.totalQuestions / stats.attempts;
            
            stats.history.push({
                date: studyData.currentDate,
                timestamp: Date.now(),
                practiceQuestions: practiceQuestions,
                wrongCount: wrongCount,
                accuracy: accuracy,
                note: note,
                timeSpent: practiceTime,
                isRepeated: isRepeated
            });
            
            // æ›´æ–°æ€»ä½“æ•°æ®
            studyData.overall.totalQuestions += practiceQuestions;
            studyData.overall.totalCorrect += correctCount;
            studyData.overall.totalTime += practiceTime;
            studyData.overall.totalSessions++;
            studyData.overall.avgQuestionsPerSession = studyData.overall.totalQuestions / studyData.overall.totalSessions;
            
            // æ›´æ–°ä»Šæ—¥æ•°æ®
            studyData.daily.totalTime += practiceTime;
            studyData.daily.sessions.push({
                moduleId: module.id,
                moduleName: module.name,
                practiceQuestions: practiceQuestions,
                wrongCount: wrongCount,
                accuracy: accuracy,
                timeSpent: practiceTime,
                timestamp: Date.now(),
                isRepeated: isRepeated
            });
            
            // å¦‚æœæ˜¯é¦–æ¬¡å®Œæˆè¿™ä¸ªæ¨¡å—ï¼ˆæœ¬è½®ï¼‰ï¼ŒåŠ å…¥completedåˆ—è¡¨
            if (!isRepeated && !studyData.daily.completed.includes(module.id)) {
                studyData.daily.completed.push(module.id);
                studyData.todayCompleted++;
            }
            
            let coachMessage = '';
            if (accuracy >= 90) {
                coachMessage = `ğŸ’ å®Œç¾ï¼${module.name}æ­£ç¡®ç‡${accuracy.toFixed(1)}%ï¼Œå¤ªå¼ºäº†ï¼`;
            } else if (accuracy >= 80) {
                coachMessage = `âœ… ä¼˜ç§€ï¼${module.name}å®Œæˆï¼Œæ­£ç¡®ç‡${accuracy.toFixed(1)}%`;
            } else if (accuracy >= 70) {
                coachMessage = `ğŸ‘ ä¸é”™ï¼${module.name}æ­£ç¡®ç‡${accuracy.toFixed(1)}%ï¼Œç»§ç»­åŠ æ²¹ï¼`;
            } else {
                coachMessage = `ğŸ“ ${module.name}å®Œæˆï¼Œæ­£ç¡®ç‡${accuracy.toFixed(1)}%ï¼Œéœ€è¦åŠ å¼ºç»ƒä¹ ï¼`;
            }
            
            if (isRepeated) {
                coachMessage = `ğŸ”„ é‡å¤ç»ƒä¹ å®Œæˆï¼${coachMessage}`;
            }
            
            showNotification("ç»ƒä¹ å®Œæˆ", coachMessage, accuracy >= 80 ? "success" : "info");
            
            // æ£€æŸ¥æ˜¯å¦å®Œæˆä¸€è½®
            if (studyData.daily.completed.length >= studyData.modules.length) {
                studyData.currentRound++;
                studyData.totalRounds++;
                
                studyData.daily.completed = [];
                studyData.todayCompleted = 0;
                studyData.daily.totalTime = 0;
                studyData.daily.sessions = [];
                
                showNotification("ğŸ‰ æ­å–œï¼", `å®Œæˆç¬¬${studyData.currentRound-1}è½®å­¦ä¹ ï¼Œå¼€å§‹ç¬¬${studyData.currentRound}è½®ï¼`, "success");
            }
            
            closeCompleteModal();
            updateDisplay();
            
            currentModuleInfo = null;
        }
        
        function closeCompleteModal() {
            document.getElementById('completeModal').style.display = 'none';
            const noteInput = document.getElementById('noteInput');
            if (noteInput) noteInput.value = '';
            currentModuleInfo = null;
        }
        
        // ============================================
        // å…¶ä»–åŠŸèƒ½
        // ============================================
        
        function showResetModal() {
            document.getElementById('resetModal').style.display = 'flex';
        }
        
        function closeResetModal() {
            document.getElementById('resetModal').style.display = 'none';
        }
        
        function resetToday() {
            if (confirm('ç¡®å®šé‡ç½®å½“å‰è½®æ¬¡è¿›åº¦å—ï¼Ÿæ‰€æœ‰å·²å®Œæˆçš„æ¨¡å—å°†è¢«æ ‡è®°ä¸ºæœªå®Œæˆï¼Œæœ¬è½®é‡æ–°å¼€å§‹ã€‚')) {
                studyData.todayCompleted = 0;
                studyData.currentModuleIndex = 0;
                studyData.daily.completed = [];
                studyData.daily.totalTime = 0;
                studyData.daily.sessions = [];
                
                closeResetModal();
                updateDisplay();
                showNotification("é‡ç½®å®Œæˆ", "å½“å‰è½®æ¬¡å·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°å¼€å§‹å­¦ä¹ ", "info");
            }
        }
        
        function showClearAllModal() {
            document.getElementById('resetConfirmInput').value = '';
            document.getElementById('clearAllBtn').disabled = true;
            document.getElementById('clearAllModal').style.display = 'flex';
        }
        
        function closeClearAllModal() {
            document.getElementById('clearAllModal').style.display = 'none';
        }
        
        function clearAllData() {
            if (confirm('æœ€åç¡®è®¤ï¼šè¿™å°†æ¸…ç©ºæ‰€æœ‰å­¦ä¹ æ•°æ®ï¼Œæ— æ³•æ¢å¤ï¼')) {
                studyData.currentDate = getTodayDate();
                studyData.currentRound = 1;
                studyData.currentModuleIndex = 0;
                studyData.todayCompleted = 0;
                studyData.totalRounds = 0;
                
                studyData.overall = {
                    totalQuestions: 0,
                    totalCorrect: 0,
                    streakDays: 1,
                    totalDays: 1,
                    lastStudyDate: getTodayDate(),
                    totalTime: 0,
                    totalSessions: 0,
                    avgQuestionsPerSession: 0
                };
                
                studyData.moduleStats = {};
                
                studyData.daily = {
                    date: getTodayDate(),
                    completed: [],
                    startTime: Date.now(),
                    totalTime: 0,
                    sessions: []
                };
                
                studyData.modules = [
                    { id: 1, name: "è¨€è¯­ç‰‡æ®µé˜…è¯»", category: "è¨€è¯­ç†è§£", time: 30, questions: 20, desc: "æ¯é¢˜â‰¤10å­—å†™æ ¸å¿ƒè®ºç‚¹", order: 1 },
                    { id: 2, name: "é€»è¾‘åˆ¤æ–­", category: "åˆ¤æ–­æ¨ç†", time: 35, questions: 20, desc: "å†™è®ºè¯ç±»å‹+é€»è¾‘é“¾", order: 2 },
                    { id: 3, name: "èµ„æ–™åˆ†æ", category: "èµ„æ–™åˆ†æ", time: 35, questions: 20, desc: "å£è¿°æœ€éš¾è®¡ç®—æ€è·¯", order: 3 },
                    { id: 4, name: "è¨€è¯­å¡«ç©º", category: "è¨€è¯­ç†è§£", time: 30, questions: 20, desc: "è®°å½•çŠ¹è±«é€‰é¡¹å¹¶è¾¨æ", order: 4 },
                    { id: 5, name: "å›¾å½¢æ¨ç†", category: "åˆ¤æ–­æ¨ç†", time: 25, questions: 20, desc: "æ³¨é”™/æ…¢é¢˜'æ­»åœ¨ä½•æ­¥'", order: 5 },
                    { id: 6, name: "å®šä¹‰åˆ¤æ–­", category: "åˆ¤æ–­æ¨ç†", time: 25, questions: 20, desc: "å…ˆè‡ªè¯é‡è¿°å®šä¹‰", order: 6 },
                    { id: 7, name: "ç±»æ¯”æ¨ç†", category: "åˆ¤æ–­æ¨ç†", time: 20, questions: 20, desc: "é”™é¢˜åå‘æ„é€ ä¾‹å­", order: 7 },
                    { id: 8, name: "ç»ˆæä»»åŠ¡", category: "ç»¼åˆè®­ç»ƒ", time: 60, questions: 1, desc: "ç”³è®º/é”™æ€/ä½“èƒ½ä¸‰é€‰ä¸€", order: 8 }
                ];
                
                closeClearAllModal();
                saveData();
                updateDisplay();
                
                showNotification("æ•°æ®å·²æ¸…ç©º", "æ‰€æœ‰å­¦ä¹ æ•°æ®å·²é‡ç½®", "info");
            }
        }
        
        function exportData() {
            const dataStr = JSON.stringify(studyData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `å…¬è€ƒå­¦ä¹ æ•°æ®_${getTodayDate()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            setTimeout(() => URL.revokeObjectURL(url), 100);
            showNotification("å¯¼å‡ºæˆåŠŸ", "å­¦ä¹ æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶", "success");
        }
        
        function showStatsModal() {
            const statsContent = document.getElementById('statsContent');
            statsContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <div style="background: #f7fafc; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 13px; color: #718096; margin-bottom: 4px;">æ€»å­¦ä¹ è½®æ¬¡</div>
                            <div style="font-size: 20px; font-weight: 700; color: #2d3748;">${studyData.totalRounds}</div>
                        </div>
                        <div style="background: #f7fafc; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 13px; color: #718096; margin-bottom: 4px;">è¿ç»­å­¦ä¹ å¤©æ•°</div>
                            <div style="font-size: 20px; font-weight: 700; color: #2d3748;">${studyData.overall.streakDays}</div>
                        </div>
                        <div style="background: #f7fafc; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 13px; color: #718096; margin-bottom: 4px;">æ€»ç»ƒä¹ é¢˜æ•°</div>
                            <div style="font-size: 20px; font-weight: 700; color: #2d3748;">${studyData.overall.totalQuestions}</div>
                        </div>
                        <div style="background: #f7fafc; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 13px; color: #718096; margin-bottom: 4px;">å¹³å‡æ­£ç¡®ç‡</div>
                            <div style="font-size: 20px; font-weight: 700; color: #2d3748;">${studyData.overall.totalQuestions > 0 ? ((studyData.overall.totalCorrect / studyData.overall.totalQuestions) * 100).toFixed(1) : 0}%</div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div style="font-size: 15px; font-weight: 600; color: #2d3748; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #e2e8f0;">ğŸ“ˆ æ¨¡å—è¡¨ç°æ’è¡Œ</div>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${studyData.modules.map((module, index) => {
                            const stats = studyData.moduleStats[module.id];
                            if (!stats || stats.attempts === 0) return '';
                            const accuracy = (stats.totalCorrect / stats.totalQuestions * 100).toFixed(1);
                            return `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f0f4f8;">
                                    <div style="font-size: 13px;">${module.name}</div>
                                    <div>
                                        <span style="font-weight: 700; color: ${accuracy >= 80 ? '#27ae60' : accuracy >= 70 ? '#f39c12' : '#e74c3c'}">${accuracy}%</span>
                                        <span style="font-size: 11px; color: #718096; margin-left: 8px;">${stats.attempts}æ¬¡</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            document.getElementById('statsModal').style.display = 'flex';
        }
        
        function closeStatsModal() {
            document.getElementById('statsModal').style.display = 'none';
        }
        
        function showNotification(title, message, type = 'info') {
            console.log(`ğŸ“¢ ${title}: ${message}`);
        }
        
        // ============================================
        // äº‹ä»¶ç›‘å¬å™¨
        // ============================================
        
        function setupEventListeners() {
            // åŒæ­¥æ»‘å—å’Œè¾“å…¥æ¡†
            const questionsSlider = document.getElementById('questionsSlider');
            const questionsInput = document.getElementById('questionsInput');
            const wrongRange = document.getElementById('wrongRange');
            const wrongInput = document.getElementById('wrongInput');
            
            if (questionsSlider && questionsInput) {
                questionsSlider.addEventListener('input', function() {
                    questionsInput.value = this.value;
                    updateRealTimeFeedback();
                });
                
                questionsInput.addEventListener('input', function() {
                    questionsSlider.value = this.value;
                    updateRealTimeFeedback();
                });
            }
            
            if (wrongRange && wrongInput) {
                wrongRange.addEventListener('input', function() {
                    wrongInput.value = this.value;
                    updateRealTimeFeedback();
                });
                
                wrongInput.addEventListener('input', function() {
                    wrongRange.value = this.value;
                    updateRealTimeFeedback();
                });
            }
            
            // æ¸…ç©ºæ•°æ®ç¡®è®¤è¾“å…¥
            const resetConfirmInput = document.getElementById('resetConfirmInput');
            const clearAllBtn = document.getElementById('clearAllBtn');
            
            if (resetConfirmInput && clearAllBtn) {
                resetConfirmInput.addEventListener('input', function() {
                    clearAllBtn.disabled = this.value.toUpperCase() !== 'DELETE';
                });
            }
            
            // å…¨å±€è¾“å…¥ç›‘å¬
            document.addEventListener('input', function(e) {
                if (e.target.id === 'questionsInput' || e.target.id === 'questionsSlider' || 
                    e.target.id === 'wrongInput' || e.target.id === 'wrongRange') {
                    updateRealTimeFeedback();
                }
            });
        }
        
        // ============================================
        // å¯åŠ¨
        // ============================================
        
        window.onload = function() {
            init();
            
            // å¯¼å‡ºå…¨å±€å‡½æ•°
            window.showModuleDetails = showModuleDetails;
            window.startRecommended = startRecommended;
            window.closeDetailModal = closeDetailModal;
            window.startDetailModule = startDetailModule;
            window.filterModules = filterModules;
            window.completeModule = completeModule;
            window.submitComplete = submitComplete;
            window.closeCompleteModal = closeCompleteModal;
            window.showEditModal = showEditModal;
            window.closeEditModal = closeEditModal;
            window.showAddModuleModal = showAddModuleModal;
            window.closeAddModuleModal = closeAddModuleModal;
            window.moveModule = moveModule;
            window.removeModule = removeModule;
            window.addModule = addModule;
            window.saveModules = saveModules;
            window.showResetModal = showResetModal;
            window.closeResetModal = closeResetModal;
            window.resetToday = resetToday;
            window.showClearAllModal = showClearAllModal;
            window.closeClearAllModal = closeClearAllModal;
            window.clearAllData = clearAllData;
            window.exportData = exportData;
            window.showStatsModal = showStatsModal;
            window.closeStatsModal = closeStatsModal;
            window.updateRealTimeFeedback = updateRealTimeFeedback;
        };
    </script>
</body>
</html>
